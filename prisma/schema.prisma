datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
  // previewFeatures = []
}

generator dbml {
  provider = "prisma-dbml-generator"
}

generator nestgraphql {
  provider           = "node node_modules/prisma-nestjs-graphql"
  output             = "../src/@generated"
  omitModelsCount    = true
  noAtomicOperations = true
}

model KYCDetail {
  id             String    @id @default(cuid())
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  userId         String    @unique
  kycStatus      KycStatus @default(NOT_INITIALIZED)
  failedRemarks  String?
  userMetadata   String
  whitelabelId   String
  kycApplicantId String?   @unique
  kycStage       KYCStage  @default(NOT_INITIALIZED)
}

model SyncDetails {
  id           String   @id @default(cuid())
  lastSyncedAt DateTime
  actionName   String   @unique
  metadata     String?
}

model UserBTCAddress {
  id           String                   @id @default(cuid())
  createdAt    DateTime                 @default(now())
  updatedAt    DateTime                 @updatedAt
  address      String                   @unique
  userId       String
  whitelabelId String
  txns         BTCIncomingTransaction[]
}

model BTCSettlementTransaction {
  id                  String                 @id @default(cuid())
  createdAt           DateTime               @default(now())
  updatedAt           DateTime               @updatedAt
  incomingTxnId       String                 @unique
  incomingTxn         BTCIncomingTransaction @relation(fields: [incomingTxnId], references: [id])
  orderId             String?                @unique
  orderplaceTime      DateTime?
  amountReceivedInUSD String?
  status              BTCTxnProcessStatus    @default(NOT_INITIALIZED)
  failedRemarks       String?
}

model BTCIncomingTransaction {
  id            String                    @id @default(cuid())
  createdAt     DateTime                  @default(now())
  updatedAt     DateTime                  @updatedAt
  txnHash       String                    @unique
  binanceTxnId  String                    @unique
  txnTime       DateTime
  amount        String
  senderAddress String
  settlementTxn BTCSettlementTransaction?
  user          UserBTCAddress            @relation(fields: [senderAddress], references: [address])
  txnStatus     TxnStatus
  failedRemarks String?
}

model KYCUser {
  id             String    @id @default(cuid())
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  userId         String    @unique
  whitelabelId   String
  kycApplicantId String?   @unique
  kycStatus      KycStatus @default(NOT_INITIALIZED)
  inspectionId   String?   @unique
  kycData        String?
  metadata       String?
}

// model SolSettlementTransaction {
//   id                  String                 @id @default(cuid())
//   createdAt           DateTime               @default(now())
//   updatedAt           DateTime               @updatedAt
//   incomingTxnId       String                 @unique
//   incomingTxn         SolIncomingTransaction @relation(fields: [incomingTxnId], references: [id])
//   orderId             String?                @unique
//   orderplaceTime      DateTime?
//   amountReceivedInUSD String?
//   status              BTCTxnProcessStatus    @default(NOT_INITIALIZED)
//   failedRemarks       String?
// }

// model SolIncomingTransaction {
//   id            String                    @id @default(cuid())
//   createdAt     DateTime                  @default(now())
//   updatedAt     DateTime                  @updatedAt
//   txnHash       String?                    @unique
//   provisionTxnHash       String                    @unique
//   binanceTxnId  String?                    @unique
//   txnTime       DateTime?
//   amountRequestedInUSDC        String
//   amountReceivedInUSDC        String?
//   senderAddress String
//   failedRemarks String?
//   txnStatus     TxnStatus @default(NOT_INITIALIZED)
//   settlementTxn SolSettlementTransaction?
// }

enum TxnStatus {
  // NOT_INITIALIZED
  PENDING
  SUCCESS
  ERROR
}

enum BTCTxnProcessStatus {
  NOT_INITIALIZED
  PENDING
  SUCCESS
  FAILED
}

enum KycStatus {
  NOT_INITIALIZED
  PENDING
  FAILED
  RETRY
  SUCCESS
}

enum KYCStage {
  NOT_INITIALIZED
  ID_CREATED
  PASSPORT_UPLOADED
  SELFIE_UPLOADED
  REQUEST_CHECKED
}
